@using System.Globalization
@model BudgetOnline.UI.Models.Editors.CurrencyBundle
@(new BudgetOnline.UI.Views.Editors.CurrencyBundle().Render(Model, ViewData.ModelMetadata.PropertyName, ViewData.ModelState[ViewData.ModelMetadata.PropertyName], ViewData.ModelMetadata.AdditionalValues))

@*@{
    var id = Html.GetUniqId(10);

    var placeholder = "";
    if (ViewData.ModelMetadata.AdditionalValues.ContainsKey("placeholder"))
    {
        placeholder = ViewData.ModelMetadata.AdditionalValues["placeholder"].ToString();
    }

    ModelState state = ViewData.ModelState[ViewData.ModelMetadata.PropertyName];
    var value = Model.Sum.ToString(CultureInfo.CurrentUICulture);

    var cssFormulaClass = "span10 data-type-calculator input-block-level";
    if (state != null && state.Errors.Count > 0)
    {
        cssFormulaClass += " input-validation-error";
    }

    var cssCurrencyListClass = " data-type-calculator input-block-level";
    if (state != null && state.Errors.Count > 0)
    {
        cssCurrencyListClass += " input-validation-error";
    }

    var cssAccountListClass = " data-type-calculator input-block-level";
    if (state != null && state.Errors.Count > 0)
    {
        cssAccountListClass += " input-validation-error";
    }

    <div  id="@id">
        <div class="row-fluid">
            <div class="span4">
                <div class="row-fluid">
                    <div class="span12">
                        @(Html.DropDownList("Account", Model.Account.Items, new { @class = cssAccountListClass }))
                    </div>
                </div>
            </div>
            <div class="span4">
                <div class="row-fluid">
                    <div class="input-append span12">
                        @Html.TextBox("Formula", Model.Formula, new { @class = @cssFormulaClass, autocomplete = "off", placeholder })
                        <span class="add-on"><i class="icon-comment"></i></span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        @Html.TextBox("Sum", value, new { @class = "calculator-result span10", @readonly = "readonly", autocomplete = "off", title = "Результат из поля Сумма" })
                    </div>
                </div>
            </div>
            <div class="span4">
                <div class="row-fluid">
                    <div class="span12">
                        @(Html.DropDownList("Currency", Model.Currency.Items, new { @class = cssCurrencyListClass }))
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            turnOn_calculator('@(id)');
        });
    </script>
}
*@